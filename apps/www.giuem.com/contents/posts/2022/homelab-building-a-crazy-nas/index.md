---
title: DIY NAS
date: 2022-08-31 16:01:14
lead:
---

几年前我用[蜗牛星际](/blog/j1900-nas)组了一台 NAS，用来挂 PT 下载，非常稳定，没有出现过数据损坏的问题。最近随着下载数据量增大，原有的 10T 左右的 JBOD 阵列已经快满了，遂决定扩容升级。<!--more-->

之前系统用的是 OMV5，有一次手贱升级到 OMV6 后系统挂了，爬了会论坛根据前人提示手动敲了一些命令才解决，但是修了没有完全修好，在修改配置时服务器经常出现 500 错误、命令执行失败；加上个人感觉升级到 OMV6 后 UI 操作反而没有之前直观方便了，于是决定换个系统重新开始。

首先明确需求，我对于这台 NAS 的预期是下载机加媒体库，不会存放重要数据，硬盘可以随意扩展，不同容量的硬盘可以在一起组成阵列（方便捡垃圾）。在这个需求下 ZFS 文件系统由于扩容不方便直接被我排除了。调研下来，比较满足我需求的只剩下 SnapRAID 和 Unraid。Unraid 在 Docker 和 VM 管理以及硬件直通上提供直观的操作界面，作为付费系统，有技术支持，可以免去许多

## 基础配置

- CPU: Intel Xeon E-2286M
- 主板: 华擎 Z370 Taichi
- 内存: 铂胜 C9BJZ 3200Mhz 8G\*2
- 机箱: 银欣 RM41-H08
- 电源: 海韵 FOCUS GX850 金牌
- 散热: 利民 AXP90-X53
- HBA: LSI 9217-8i

## 配件开箱

CPU 使用的是闪电家的魔改 E-2286M，8 核 16 线程，单核睿频 5.0 GHz，全核心 4.1 GHz，TDP 45W(仅供参考)。性能接近桌面版 CPU i7-9900 的水平。

![](./assets/IMG_4769.jpg)
![](./assets/IMG_4770.jpg)

主板是某鱼上淘的二手 Z370 太极，选这块主板主要看重几点

- 带 Debug 码，排查定位问题比较容易，特别是使用魔改 CPU、魔改 BIOS 这种不太稳定的场景
- PCIe 支持 x8+x4+x4 划分，方便后续接显卡、网卡等设备
- 主板提供了 3 个 M2 插槽（其中一个支持 22110 长度）和 8 个 SATA3 接口，后续接缓存 SSD 或者上大船 M2 都比较方便
- 自带 2 个千兆网口，可以做链路聚合，开虚拟机也能直通一个网口

LGA1151 插槽
![](./assets/IMG_4776.jpg)
![](./assets/IMG_4775.jpg)

3 条 PCIe x16 插槽及 3 个 M2 接口
![](./assets/IMG_4774.jpg)

背部 IO 接口，有两个千兆网口
![](./assets/IMG_4778.jpg)

上 CPU
![](./assets/IMG_4779.jpg)

拧上 3 颗螺丝
![](./assets/IMG_4780.jpg)

内存使用的是镁光 C9BJZ 颗粒，之前装机闲置下来的一对内存。

![](./assets/IMG_4768.jpg)

电源使用了海韵 FOCUS GX850 金牌电源，也是之前装机闲置下来的。这个瓦数对于这套配置来说有点过剩了。

![](./assets/IMG_4787.jpg)

![](./assets/IMG_4784.jpg)

5V 有 20A 的输出电流，12V 有 70A 的输出电流。按照 HC550 的最大供电要求计算，带 20 个硬盘都不是问题。

![](./assets/IMG_4785.jpg)

散热器使用利民 AXP90-X53 黑化版，在定基本配置的时候还没确定要使用的机箱。考虑兼容性，选择了下压式散热器。官方宣传散热能力是 150W，对于这款移动版的志强 CPU 绰绰有余。

![](./assets/IMG_4789.jpg)

![](./assets/IMG_4790.jpg)

阵列卡使用的是浪潮拆机 LSI 9217-8i，刷了直通模式，作为 HBA 卡使用。这块 HBA 卡发热巨大，没连接任何设备的情况下，开机 5 分钟就非常烫手。因此自己又加装了个 4CM 小风扇。

![](./assets/IMG_4791.jpg)

## 上机测试

转接 CPU 需要刷魔改 BIOS 才能正常开机。一般主板都不支持直刷，需要用到编程器。这里我用的是 CH431A 编程器+免拆夹套装，无奈 BIOS 芯片触点太小了，一直夹不上。后面爬论坛了解到可以 SPI 接口刷 BIOS，我这块主板的 SPI 接口就在 BIOS 芯片旁边。

![](./assets/IMG_4792.jpg)

有杜邦线的话可以直接用下面的针脚定义连接编程器，或者淘宝上买现成的转接线。

```
| 7 | 8 | x | 6 | 5 |
| 3 | 1 | 2 | n | 4 |

1-8 - spi flash pins like in chip datasheet
x - empty pin
n - dont know, doesnt ring
```

编程器这么连，注意接口 1 应该在右上角

![](./assets/IMG_4793.jpg)

连上后，打开编程器软件（我这里直接用卖家发的软件），点击检测先看看能不能正常识别。没问题的话，依次点击擦除-查空先清空编程器，然后拖入魔改的 BIOS，依次点击编程-校验即可刷入 BIOS。

![](./assets/编程器.png)

插电开机，进入 BIOS，可以看到 CPU 型号可以正常识别，检查下内存也没问题。

进入系统

全核心 4.2，之后 撞墙后 3.0 最高温度 70 度，稳定后 56 度

valvlavl

## 机箱选择
